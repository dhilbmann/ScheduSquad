@model AvailabilityViewModel

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewData["Title"] = "Member Availability Page";
}

<br />
<br />
<p>Availabilities</p>
<table class="table table-bordered table-responsive table-hover">
    <tr role="row">
        <th>Day</th>
        <th>Start Time</th>
        <th>End Time</th>
    </tr>
    <div class="availabilityChart"></div>
    @foreach (ScheduSquad.Models.Availability a in Model.availabilities)
    {
        Html.RenderPartial("AvailabilityReadRow", a);
    }
    </div>
</table>

<p>
    <table id="editRow">
        <td role="cell"><button class="btn btn-primary add-button">+ Add</button></td>

    </table>
</p>

<script>
    $(document).ready(function () {

        ////////// Add ////////
        $('.add-button').click(function () 
        {
            //Ajax call to get add row Availability/AvailabilityEditRow(availId)
            $.ajax(
            {
                url: '@Url.Action("GetAvailabilityEditRow")',
                type: "GET",
                data: {'availabilityId' : "00000000-0000-0000-0000-000000000000"}
            }).done(function(result) 
            {
                $('#editRow').html(result);
            });
            //find edit button row and replace with Ajax result and define click functions
        });



        ////////// Edit ////////
        $('.edit-button').click(function () 
        {
            var availId = $(this).data('availability-id');
            //Ajax call to get edit row Availability/AvailabilityEditRow(availId)
            $.ajax(
            {
                url: '@Url.Action("GetAvailabilityEditRow")',
                type: "GET",
                data: {'availabilityId' : availId}
            }).done(function(result) 
            {
                $('#'+availId).html(result);
            });
            //find edit button row and replace with Ajax result and define click functions
        });

        ////////// Delete ////////
        $('.delete-button').click(function () 
        {
            var availId = $(this).data('availability-id');

            var availabilityToDelete = {
                Id: availId, 
                IsDeleted : true,
                DayOfWeek : 1,
                StartTime : "00:00",
                EndTime : "00:00",
            };

            $.ajax(
            {
                url: 'Availability/DeleteAvailability',
                type: "POST",
                data: availabilityToDelete
            }).done(function(result) 
            {
                location.reload();
            });
        });

        ////////// Save ////////
        $('.save-button').click(function () {

            var availId = $(this).data('availability-id');
            var startTime = $(this).data('start-hour') +":" + $(this).data('start-minute');
            var endTime = $(this).data('end-hour') +":" + $(this).data('end-minute');
            var day = $(this).data('day-list');
            
            var availability = {
                Id: availId, 
                IsDeleted : false,
                DayOfWeek : day,
                StartTime : startTime,
                EndTime : endTime,
            };

            $.ajax(
            {
                url: 'Availability/SaveAvailability',
                type: "POST",
                data: availability
            }).done(function(result) 
            {
                location.reload();
            });
        });

        ////////// Cancel ////////
        $(document).on('click', '#save-button', function(){ 
                location.reload();
        });
    });


</script>