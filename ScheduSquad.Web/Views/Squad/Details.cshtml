@model SquadDetailsViewModel

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewData["Title"] = "Squad Details";
}
<div class="container">
    <div class="row">
        <div class="col justify-content-start">
            <h1>Squad Details</h1>
        </div>
    </div>

    <div class="row justify-content-between">
        <div class="col">
            <p>Details</p>
        </div>
        <div class="col">
            <p>This Squad has @Model.Members.Count() members</p>
        </div>
        <div class="col">
            <div>
                @if (Model.SquadBelongsToUser)
                {
                    <button class="btn btn-primary manage-squad" asp-controller="SquadManagement" asp-action="Members">Manage Members</button>
                }
                else
                {
                    <button class="btn btn-primary leave-squad" data-squad-id="@Model.SquadId" data-user-id="@Model.UserId">Leave Squad</button>
                }
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col md-12">
            <table class="table table-striped">
                <thead>
                    <tr role="row">
                        <th>First Name</th>
                        <th>Last Name</th>
                        <th>Email</th>
                        <th>Date Joined</th>
                        <th>Availabilities</th>
                    </tr>
                <thead>
                <tbody>
                    @foreach (SquadDetailModel m in Model.Members)
                    {
                        <tr role="row">
                            <td role="cell">@m.FirstName</td>
                            <td role="cell">@m.LastName</td>
                            <td role="cell">@m.Email</td>
                            <td role="cell">@m.JoinDate.ToShortDateString()</td>
                            <td role="cell">@m.AvailabilityCount</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>

    @foreach (String s in Model.AvailabilityStrings)
    {
        <div class="row">
            <p>Available @s</p>
        </div>
    }
</div>

@section scripts {
    <script>
        $(document).ready(function () {
            $('.leave-squad').click(function () {
                var squadId = $(this).data('squad-id');
                var userId = $(this).data('user-id');
                $.post('/SquadManagement/RemoveMember', { squadId: squadId, memberId: userId }, function (data) {
                    if (data.success) {
                        window.location.reload();
                    } else {
                        alert('Failed to remove from squad. Please try again.');
                    }
                });
            });
        });
    </script>
}
    